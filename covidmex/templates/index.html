{% extends "layout.html" %}
{% block title %}Principales Indicadores{% endblock %}
{% block contenthead %}
<!-- Content Wrapper. Contains page content -->
<div class="content-wrapper">
<!-- Content Header (Page header) -->
<div class="content-header">
  <div class="container-fluid">
    <div class="row mb-2">
      <div class="col-sm-6">
        <h1 class="m-0 text-dark">{% block pagetitle %} Indicadores COVID 19 en México {% endblock %}</h1>
        <h6 class="m-0 text-dark"><b>Última actualización: {% block updated %} {{ vars.update_time }}</b>{% endblock %}</h6>
        <iframe defer src="https://www.facebook.com/plugins/share_button.php?href=https%3A%2F%2Fcovidmex.live&layout=button&size=small&appId=263654680372835&width=89&height=20" width="89" height="20" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowTransparency="true" allow="encrypted-media"></iframe>

         <a class="twitter-share-button" href="https://twitter.com/intent/tweet?hashtags=covid19,covid19mx&text=Conoce #COVIDMEX el sitio de datos abiertos de COVID 19 en México">Tweet</a>  
      </div><!-- /.col -->
    </div><!-- /.row -->
  </div><!-- /.container-fluid -->
</div>
<!-- /.content-header -->
{% endblock contenthead %}

{% block content %}
<section class="content">
  <div class="container-fluid">
    <!-- Small boxes (Stat box) -->
    <div class="row">
      <div class="col-lg-3 col-6">
        <!-- small box -->
        <div class="small-box bg-info">
          <div class="inner">
            <h3>{{ vars.delta_confirmed }}</h3>

            <p>Últimas 24 horas</p>
          </div>

        </div>
      </div>
      <!-- ./col -->
      <div class="col-lg-3 col-6">
        <!-- small box -->
        <div class="small-box bg-success">
          <div class="inner">
            <h3>{{ vars.total_confirmed }}</h3>

            <p>Total casos confirmados</p>
          </div>

        </div>
      </div>
      <!-- ./col -->
      <div class="col-lg-3 col-6">
        <!-- small box -->
        <div class="small-box bg-warning">
          <div class="inner">
            <h3>{{ vars.total_suspected }}</h3>

            <p>Casos sospechosos</p>
          </div>

        </div>
      </div>
      <!-- ./col -->
      <div class="col-lg-3 col-6">
        <!-- small box -->
        <div class="small-box bg-danger">
          <div class="inner">
            <h3>{{ vars.total_death }}</h3>

            <p>Defunciones</p>
          </div>

        </div>
      </div>
      <!-- ./col -->
    </div>
    <!-- /.row -->
    <!-- Main row -->
    <div class="row">
      <!-- Left col -->
      <section class="col-lg-7 connectedSortable">
        <!-- Custom tabs (Charts with tabs)-->
        <div class="card">
          <div class="card-header">
            <div class="d-flex justify-content-between">
              <h3 class="card-title">Histograma de casos</h3>
            </div>
          </div>
          <div class="card-body">
            <div class="d-flex">
              <p class="d-flex flex-column">
                <span class="text-bold text-lg">{{ vars.total_confirmed }}</span>
                <span>Casos desde el inicio</span>
              </p>

            </div>
            <!-- /.d-flex -->

            <div class="position-relative mb-4">
              <canvas id="histogram-chart" height="200"></canvas>
            </div>

            <div class="d-flex flex-row justify-content-end">
              <span class="mr-2">
                <i class="fas fa-square text-success"></i> Casos confirmados
                <i class="fas fa-square text-warning"></i> Casos sospechosos
              </span>
            </div>
          </div>
        </div>
        <!-- /.card -->

        <div class="card">
          <div class="card-header">
            <div class="d-flex justify-content-between">
              <h3 class="card-title">Casos confirmados por rango de edad</h3>
            </div>
          </div>
          <div class="card-body">
            <div class="d-flex">

            </div>
            <!-- /.d-flex -->

            <div class="position-relative mb-4">
              <canvas id="ages-chart" height="200"></canvas>
            </div>

            <div class="d-flex flex-row justify-content-end">
              <span class="mr-2">
                <i class="fas fa-square text-primary"></i> Casos confirmados
              </span>


            </div>
          </div>
        </div>
         <!--div class="card">
          <div class="card-header">
            <div class="d-flex justify-content-between">
              <h3 class="card-title">Mapa de casos por estado</h3>
            </div>
          </div>
          <div class="card-body">  

          <iframe src="https://www.google.com/maps/d/embed?mid=1-XnTNpU7R4XiVewJh_nwcpUrtGgd4gwu" width="640" 
          height="480"></iframe>          
            Mapa creado por <a target="_blank" href="https://twitter.com/min_sism_miguel">@min_sism_miguel</a>. El mapa se acualiza en un horario diferente pero de la misma fuente. Consultar detalles en la información del mapa.
          </div>
        </div-->
        <!--/.direct-chat -->

        <!-- /.card -->
      </section>
      <!-- /.Left col -->
      <!-- right col (We are only adding the ID to make the widgets sortable)-->
      <section class="col-lg-5 connectedSortable">
       <!-- DONUT CHART -->
           <div class="card">
              <div class="card-header">
                <h3 class="card-title">
                  <i class="far"></i>
                  Indicadores
                </h3>

                <div class="card-tools">
                </div>
              </div>
              <!-- /.card-header -->
              <div class="card-body">
                <div class="row">

                  <div class="col-6 col-md-3 text-center">
                    <input type="text" class="knob" value="{{ vars.death_ratio }}" data-min="0" data-max="50" data-width="90"
                           data-height="90" data-fgColor="#DC3545">

                    <div class="knob-label">Porcentaje de mortalidad en México</div>
                  </div>
                  <div class="col-6 col-md-3 text-center">
                    <input type="text" class="knob" value="{{ vars.increase_ratio }}" data-min="0" data-max="50" data-width="90"
                           data-height="90" data-fgColor="#FFC107">

                    <div class="knob-label">Tasa de crecimiento infección</div>
                  </div>
                  <div class="col-6 col-md-3 text-center">
                    <input type="text" class="knob" value="{{ vars.total_female_percentage }}" data-min="0" data-max="100" data-width="90"
                           data-height="90" data-fgColor="#521989">

                    <div class="knob-label">{{ vars.total_female }} Casos de Mujeres</div>
                  </div>
                    <div class="col-6 col-md-3 text-center">
                    <input type="text" class="knob" value="{{ vars.total_male_percentage }}" data-min="0" data-max="100" data-width="90"
                           data-height="90" data-fgColor="#FFA500">

                    <div class="knob-label">{{ vars.total_male }} Casos de Hombres</div>
                  </div>
                </div>
                <!-- /.row -->
              </div>
              <!-- /.card-body -->
            </div>
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Top 10 Estados con más casos</h3>

            <div class="card-tools">
            </div>
          </div>
          <div class="card-body">
                    {% for state in vars.confirmed_cases_by_state %}
                    <div class="progress-group">
                      {{ state[0] }}
                      <span class="float-right"><b> {{ state[1] }}</b></span>
                      <div class="progress progress-sm">
                        <div class="progress-bar bg-success" style="width: {{ (state[1] * 100) / vars.confirmed_cases_by_state[0][1] }}%"></div>
                      </div>
                       <div class="progress progress-sm">
                        <div class="progress-bar bg-warning" style="width:"></div>
                      </div>
                    </div>
                    {% endfor %}
                    
                  </div>         
          <!-- /.card-body -->
        </div>
        <!-- /.card -->
        <div class="card card">
          <div class="card-header">
            <h3 class="card-title">Twitter Secretaria de Salud</h3>

            <div class="card-tools">

            </div>
            <!-- /.card-tools -->
          </div>
          <!-- /.card-header -->
          <div class="card-body">
            <a class="twitter-timeline" href="https://twitter.com/SSalud_mx" data-tweet-limit="2" data-width="100%" ></a>
          </div>
          <!-- /.card-body -->
        </div>
      </section>
      <!-- right col -->
    </div>
    <!-- /.row (main row) -->
  </div><!-- /.container-fluid -->
</section>
{% endblock %}
{% block js %}
  {{ super() }}
<script>
window.addEventListener('DOMContentLoaded', function() {
 $(function () {
'use strict'


  function myFunc(vars) {
      return vars
  }
  var _data  = myFunc({{vars|tojson}})
  var ticksStyle = {
    fontColor: '#495057',
    fontStyle: 'bold'
  }

  var mode      = 'index'
  var intersect = true

  var $agesChart = $('#ages-chart')
  var agesChart  = new Chart($agesChart, {
    type   : 'bar',
    data   : {
      labels  : _data.age_bars_labels,
      datasets: [
        {
          backgroundColor: '#007bff',
          borderColor    : '#007bff',
          data           : _data.age_bars_confirmed
        }
      ]
    },
    options: {
      maintainAspectRatio: false,
      tooltips           : {
        mode     : mode,
        intersect: intersect
      },
      hover              : {
        mode     : mode,
        intersect: intersect
      },
      legend             : {
        display: false
      },
      scales             : {
        yAxes: [{
          // display: false,
          gridLines: {
            display      : true,
            lineWidth    : '4px',
            color        : 'rgba(0, 0, 0, .2)',
            zeroLineColor: 'transparent'
          },
          ticks    : $.extend({
            beginAtZero: true

           
          }, ticksStyle)
        }],
        xAxes: [{
          display  : true,
          gridLines: {
            display: false
          },
          ticks    : ticksStyle
        }]
      }
    }
  })

  var $histogramChart = $('#histogram-chart')
  var histogramChart  = new Chart($histogramChart, {
    data   : {
      labels  : _data.histogram_labels,
      datasets: [{
        type                : 'line',
        data                : _data.histogram_confirmed,
        backgroundColor     : 'transparent',
        borderColor         : '#28a745',
        pointBorderColor    : '#28a745',
        pointBackgroundColor: '#28a745',
        fill                : false
        // pointHoverBackgroundColor: '#28a745',
        // pointHoverBorderColor    : '#28a745'
      },
      {
        type                : 'line',
        data                : _data.histogram_suspects,
        backgroundColor     : 'transparent',
        borderColor         : '#ffc107',
        pointBorderColor    : '#ffc107',
        pointBackgroundColor: '#ffc107',
        fill                : false
        // pointHoverBackgroundColor: '#28a745',
        // pointHoverBorderColor    : '#28a745'
      }]
    },
    options: {
      maintainAspectRatio: false,
      tooltips           : {
        mode     : mode,
        intersect: intersect
      },
      hover              : {
        mode     : mode,
        intersect: intersect
      },
      legend             : {
        display: false
      },
      scales             : {
        yAxes: [{
          // display: false,
          gridLines: {
            display      : true,
            lineWidth    : '4px',
            color        : 'rgba(0, 0, 0, .2)',
            zeroLineColor: 'transparent'
          },
          ticks    : $.extend({
            beginAtZero : true,
            suggestedMax: 200
          }, ticksStyle)
        }],
        xAxes: [{
          display  : true,
          gridLines: {
            display: false
          },
          ticks    : ticksStyle
        }]
      }
    }
  })
 }); // END

 $('.knob').knob({
      format : function (value) {
           return value + '%';
      },
      /*change : function (value) {
       //console.log("change : " + value);
       },
       release : function (value) {
       console.log("release : " + value);
       },
       cancel : function () {
       console.log("cancel : " + this.value);
       },*/
      draw: function () {

        // "tron" case
        if (this.$.data('skin') == 'tron') {

          var a   = this.angle(this.cv)  // Angle
            ,
              sa  = this.startAngle          // Previous start angle
            ,
              sat = this.startAngle         // Start angle
            ,
              ea                            // Previous end angle
            ,
              eat = sat + a                 // End angle
            ,
              r   = true

          this.g.lineWidth = this.lineWidth

          this.o.cursor
          && (sat = eat - 0.3)
          && (eat = eat + 0.3)

          if (this.o.displayPrevious) {
            ea = this.startAngle + this.angle(this.value)
            this.o.cursor
            && (sa = ea - 0.3)
            && (ea = ea + 0.3)
            this.g.beginPath()
            this.g.strokeStyle = this.previousColor
            this.g.arc(this.xy, this.xy, this.radius - this.lineWidth, sa, ea, false)
            this.g.stroke()
          }

          this.g.beginPath()
          this.g.strokeStyle = r ? this.o.fgColor : this.fgColor
          this.g.arc(this.xy, this.xy, this.radius - this.lineWidth, sat, eat, false)
          this.g.stroke()

          this.g.lineWidth = 2
          this.g.beginPath()
          this.g.strokeStyle = this.o.fgColor
          this.g.arc(this.xy, this.xy, this.radius - this.lineWidth + 1 + this.lineWidth * 2 / 3, 0, 2 * Math.PI, false)
          this.g.stroke()

          return false
        }
      }
    }); // END knob

   $(".knob").knob({
    'format' : function (value) {
       return value + '%';
    }
  });
}); // END DOMContentLoaded
 
  
</script>

{% endblock %}